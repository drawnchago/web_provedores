<h2 class="font-medium" mat-dialog-title><strong>{{action}} requision</strong></h2>
<mat-dialog-content class="pb-3">
	<form [formGroup]="form">
        <mat-tab-group  [selectedIndex]="index" (selectedTabChange)="onTabChanged($event)">
            <mat-tab label="1.-Datos generales">
                <ng-template mat-tab-label>
                        <mat-icon class="example-tab-icon">article</mat-icon>
                        1.-Datos generales
                </ng-template>
                <div>
                    <mat-form-field>
                        <mat-select placeholder="Area:" formControlName="area_id">
                            <mat-option *ngFor="let area of areas" (click)="getArea(area)"[value]="area.id">{{area.description}}</mat-option>
                        </mat-select>
                    </mat-form-field>
                    <mat-form-field>
                        <mat-select placeholder="Estatus" formControlName="status">
                            <mat-option [value]="1">Activo</mat-option>
                            <mat-option [value]="2">Inactivo</mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>
                <div >
                    <mat-form-field class="example-full-width" appearance="fill">
                        <mat-label>Comentarios</mat-label>
                        <textarea matInput  cols="150" rows="5"  formControlName="requisition_comments" placeholder="Comentarios" ></textarea>
                    </mat-form-field>
                </div>
                <button mat-flat-button color="primary" class="btn-right" (click)="nextMatTab()">Siguiente</button>
            </mat-tab>
            <mat-tab label="2.-Agregar conceptos">
                <ng-template mat-tab-label>
                        <mat-icon class="example-tab-icon">view_list</mat-icon>
                        2.-Agregar conceptos
                </ng-template>
                <mat-accordion>
                    <mat-expansion-panel class="m-exp-panel" hideToggle>
                      <mat-expansion-panel-header>
                        <mat-panel-title>
                          Agregar Conceptos
                        </mat-panel-title>
                        <mat-panel-description>
                          Da click aqui!
                          Para agregar los conceptos
                        </mat-panel-description>
                      </mat-expansion-panel-header>
                      <div class="f-m">
                        <mat-form-field fxFlex>
                            <mat-label>Buscar Producto</mat-label>
                            <input type="text" matInput formControlName="search" (keyup)="filterProduct()"  [matAutocomplete]="auto">
                            <mat-autocomplete  #auto>
                                <mat-option (click)="selectionElement(product)" *ngFor="let product of products" [value]="product.description">
                                    {{product.description}}
                                </mat-option>
                            </mat-autocomplete>
                        </mat-form-field>
                    </div>
                    <div fxLayout="row" fxLayoutAlign="space-between">
                        <div>
                            <mat-form-field appearance="outline">
                                <mat-label>Código:</mat-label>
                                <input matInput formControlName="code">
                            </mat-form-field>
                        </div>
                        <div  class="ml-5" fxFlex>
                            <mat-form-field appearance="outline">
                                <mat-label>Descripción:</mat-label>
                                <input matInput  formControlName="description">
                            </mat-form-field>
                        </div>
                    </div>
                    <div fxLayout="row" fxLayoutAlign="space-around">
    
                        <div>
                            <mat-form-field appearance="outline">
                                    <mat-label>Cantidad:</mat-label>
                                    <input matInput  type="text" (keypress)="isNumber($event)"  formControlName="quantity">
                            </mat-form-field>
                            </div>
                        <div>
                            <mat-form-field appearance="outline">
                                <mat-label>Precio unitario:</mat-label>
                                <input matInput type="text" (keypress)="isNumber($event)"  formControlName="price">
                                <span matPrefix>$</span>
                            </mat-form-field>
                        </div>
                    </div>
                    <div fxLayout="row" fxLayoutAlign="start start">
                        <textarea formControlName="comment" cols="150" rows="5" placeholder="Comentarios"></textarea>
                    </div>
                    <button mat-raised-button color="primary" class="btn-element" type="button" (click)="saveElement()"   ><mat-icon>add</mat-icon></button>
                    </mat-expansion-panel>
                    <mat-expansion-panel (opened)="panelOpenState = true"
                                         (closed)="panelOpenState = false">
                      <mat-expansion-panel-header>
                        <mat-panel-title>
                         Conceptos Agregados
                        </mat-panel-title>
                        <mat-panel-description>
                          Da click aqui!, Para ver tus conceptos agregados
                        </mat-panel-description>
                      </mat-expansion-panel-header>
                      <div class="text-alert" *ngIf="tableIsNull" >
                        <span>
                            <h2>Mensaje:</h2>
                        </span>
                        <span>
                            <h3>No hay conceptos agregados a la requisicion</h3>
                        </span>
    
                    </div>
                    <table mat-table *ngIf="!tableIsNull" [dataSource]="dataSource" class="mat-elevation-z8" class="table-2">
    
                        <!--- Note that these columns can be defined in any order.
                              The actual rendered columns are set as a property on the row definition" -->
                      
                        <!-- Code Column -->
                        <ng-container matColumnDef="code">
                          <th mat-header-cell *matHeaderCellDef> Clave </th>
                          <td mat-cell *matCellDef="let element"> {{element.code}} </td>
                        </ng-container>
                      
                        <!-- Description Column -->
                        <ng-container matColumnDef="description">
                          <th mat-header-cell *matHeaderCellDef> Descripcion </th>
                          <td mat-cell *matCellDef="let element"> {{element.description}} </td>
                        </ng-container>
                      
                        <!-- Price Column -->
                        <ng-container matColumnDef="price">
                          <th mat-header-cell *matHeaderCellDef> Precio </th>
                          <td mat-cell *matCellDef="let element"> {{element.price}} </td>
                        </ng-container>
                      
                        <!-- Quantity Column -->
                        <ng-container matColumnDef="quantity">
                          <th mat-header-cell *matHeaderCellDef> Cantidad </th>
                          <td mat-cell *matCellDef="let element"> {{element.quantity}} </td>
                        </ng-container>
    
                        <!-- Subtotal Column -->
                        <ng-container matColumnDef="subtotal">
                            <th mat-header-cell *matHeaderCellDef> Subtotal </th>
                            <td mat-cell *matCellDef="let element"> {{element.subtotal | currency}} </td>
                        </ng-container>
    
                        <!-- Action Column -->
                        <ng-container matColumnDef="action">
                            <th mat-header-cell *matHeaderCellDef> Acciones </th>
                            <td mat-cell *matCellDef="let element">  
                                <button mat-raised-button color="warn"    class="btn-element" type="button" (click)="deleteElement(element)" >
                                    <mat-icon>delete</mat-icon>
                                </button>
                            </td>
                        </ng-container>
                      
                        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
                      </table>
                    </mat-expansion-panel>
                  </mat-accordion>
                  <div class="m-button">
                    <button mat-flat-button color="warn"    class="btn-left"  (click)="previousMatTab()">Atras</button>
                    <button mat-flat-button color="primary" class="btn-right" (click)="nextMatTab()">Siguiente</button>
                  </div>
            </mat-tab>
            <mat-tab label="3.-Vista Previa">
                <ng-template mat-tab-label>
                        <mat-icon class="example-tab-icon">visibility</mat-icon>
                        3.-Vista Previa
                </ng-template>
                <div>
                    <div class="requisition-head-1">
                        <span>Requisicion de compra</span>
                    </div>
                    <div class="requisition-head-2">
                        <span  class="bold" >BOMBAS VILLASANA S.A DE C.V</span>
                        <br>
                        <br>
                        <span>Direccion:<span  class="bold">Ayutla & Lib. Lic. Carlos Salinas de Gortari, Occidental, 25640 Frontera, Coah., Mexico</span></span>
                        <br>
                        <span >Area solicitante:
                            <span  class="bold">{{' ' + area}}</span>
                        </span>
                        <br>
                        <br>
                    </div>
                    <div class="requisition-body">
                        <table class="table-2">
                            <tr>
                                <td class="table-2-td">Clave</td>
                                <td class="table-2-td">Producto</td>
                                <td class="table-2-td">Cantidad</td>
                                <td class="table-2-td">Precio por unidad</td>
                                <td class="table-2-td">Subtotal</td>
                            </tr>
                            <tr *ngFor="let concept of added_concepts " >
                                <td class="table-2-td">{{concept.code}}</td>
                                <td class="table-2-td">{{concept.description}}</td>
                                <td class="table-2-td">{{concept.quantity}}</td>
                                <td class="table-2-td">{{concept.price}}</td>
                                <td class="table-2-td">${{concept.subtotal}}</td>
                            </tr>
                            </table>
                    </div>
                    <br>
                </div>
                <div class="m-button">
                    <button mat-flat-button color="warn"    class="btn-left"  (click)="previousMatTab()">Atras</button>
                    <!-- <button mat-flat-button color="primary" class="btn-right" (click)="nextMatTab()">Siguiente</button> -->
                    <button mat-flat-button color="primary" class="btn-right" (click)="save()">Guardar requisicion</button>
                </div>
            </mat-tab>
        </mat-tab-group>
	</form>
</mat-dialog-content> 